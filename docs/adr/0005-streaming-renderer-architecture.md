# ADR-0005: æµå?æ¸²æ??¨æ¶??

## ?¶æ€?

Accepted

## ?¥æ?

2024-12-21

## ?Œæ™¯

AI Agent åº”ç”¨?„æ ¸å¿ƒäº¤äº’æ¨¡å¼æ˜¯**æµå??å?**?‚ç”¨?·å??è¯·æ±‚å?ï¼ŒAI ?æ­¥?Ÿæ??å??…å®¹ï¼ŒUI ?€è¦å??¶æ¸²?“è?äº›å??å?å®¹ã€?

### æµå?æ¸²æ??„æ???

1. **ä¸å??´ç? Markdown**
   - æµå?ä¼ è??¶ï?Markdown è¯­æ??¯èƒ½è¢«æˆª??
   - ä¾‹å?ï¼š`**bold` ç¼ºå??­å?ï¼Œ```` ``` ```` ä»???—æœªç»“æ?
   - ?‡å? Markdown è§???¨ä?å¤±è´¥?–æ¸²?“å?å¸?

2. **ä»??é«˜äº®?ªç?**
   - æ¯æ¬¡?…å®¹?´æ–°è§¦å??æ–°è§???Œé?äº?
   - å¯¼è‡´è§†è?ä¸Šç??ªç??Œæ???

3. **?§èƒ½?®é?**
   - é«˜é??´æ–°ï¼ˆå¯?½æ?ç§’å??æ¬¡ï¼?
   - ?€è¦é??ˆç? diff ?Œæ¸²??

### è°ƒç??‘ç°

?‘ç° Vercel ??[streamdown](https://github.com/vercel/streamdown) é¡¹ç›®?ä?äº†ç›¸?³è§£?³æ–¹æ¡ˆï?

- ?ºä? [remend](https://github.com/vercel/remend) åº“å??°è‡ªä¿®å? Markdown
- ä½¿ç”¨ Shiki è¿›è?ä»??é«˜äº®
- ä¸“ä¸ºæµå??ºæ™¯ä¼˜å?

## ?³ç?

?›å»º `@uix/stream` ?…ï??‡ç”¨ä»¥ä??¶æ?ï¼?

### 1. ?¸å?ç»„ä»¶

```
@uix/stream
?œâ??€ StreamMarkdown    # æµå? Markdown æ¸²æ???
?œâ??€ StreamText        # ç®€?•æ???+ ?‰æ??¨ç”»
?œâ??€ CodeBlock         # è¯­æ?é«˜äº®ä»????
?”â??€ healMarkdown()    # Markdown ?ªä¿®å¤å‡½??
```

### 2. ?ªä¿®å¤ç???

?‚è€?streamdown ?„ç?å¿µï?å®ç° `healMarkdown` ?½æ•°ï¼?

```typescript
function healMarkdown(content: string): string {
  // 1. å¤„ç??ªé—­?ˆç?ä»????
  // 2. å¤„ç??ªé—­?ˆç?è¡Œå?ä»??
  // 3. å¤„ç??ªé—­?ˆç?ç²—ä?/?œä?
  // 4. å¤„ç?ä¸å??´ç??¾æ¥
  return healedContent
}
```

### 3. æ¸²æ?æµç?

```
æµå??…å®¹ ??healMarkdown() ??ReactMarkdown ??æ¸²æ?
     ??
isStreaming=true ?¶è‡ª?¨ä¿®å¤?
isStreaming=false ?¶ç›´?¥æ¸²??
```

### 4. ?€?¯é€‰å?

| ?Ÿèƒ½ | ?‰æ‹© | ?†ç”± |
|-----|------|------|
| Markdown è§?? | react-markdown | React ?Ÿæ€æ???|
| GFM ?¯æ? | remark-gfm | è¡¨æ ¼?ä»»?¡å?è¡¨ç? |
| ä»??é«˜äº® | highlight.js | è½»é??æ”¯?å?è¯­è? |
| ?·å??¹æ? | Tailwind CSS | ä¸?UIX ä¸€??|

### 5. ?ªæ¥å¢å¼º

?‚ä?å®ç°ä½†ä??™ç©º?´ï?
- å¢é?é«˜äº®ï¼ˆé¿?å…¨?é?ç®—ï?
- ?šæ?æ»šåŠ¨ï¼ˆè??¿å?å®¹ï?
- æµå??¾è¡¨æ¸²æ?

## ?æ?

### æ­?¢

- è§?†³äº†æ?å¼æ¸²?“ç??¸å??›ç‚¹
- ?ä?äº†å?ç®±å³?¨ç?è§?†³?¹æ?
- ä¸?Lucid Design System è§†è?ä¸€??

### è´Ÿé¢

- ?ªä¿®å¤é€»è??¯èƒ½?‰è¾¹?Œæ???
- highlight.js æ¯?Shiki ?Ÿèƒ½å¼±ä?äº?

### ?ç»­?¹è?

- ?ƒè?è¿ç§»??Shikiï¼ˆæ›´?°ä»£?ä¸»é¢˜æ›´ä¸°å?ï¼?
- å¢å??´å?è¾¹ç??…å†µ?„è‡ªä¿®å?è§„å?
- ?§èƒ½ä¼˜å?ï¼ˆå?å¢é?æ¸²æ?ï¼?

## ä¸?UIX IR ?„å…³ç³?

æµå?æ¸²æ??¨é?è¦å???UIX IR ä¸?`status: 'streaming'` ??Blockï¼?

```typescript
// UIX IR Block
interface LucidBlock {
  id: string
  type: 'text' | 'tool' | 'thinking' | 'image' | 'file' | 'error'
  status: 'streaming' | 'completed' | 'error'  // æµå?æ¸²æ??¨å…³æ³¨è?ä¸?
  content: unknown
}

// æµå?æ¸²æ??¨è?ä¸?
if (block.status === 'streaming' && block.type === 'text') {
  // ä½¿ç”¨ healMarkdown å¤„ç?ä¸å??´å?å®?
  const healed = healMarkdown(block.content.text)
  return <StreamMarkdown>{healed}</StreamMarkdown>
}
```

## ?‚è€?

- [Vercel streamdown](https://github.com/vercel/streamdown)
- [Vercel remend](https://github.com/vercel/remend)
- [react-markdown](https://github.com/remarkjs/react-markdown)

## ?¸å…³?³ç?

- [ADR-0001](./0001-enterprise-grade-ui-infrastructure.md) - AI-to-UI ?è®®å±‚å?ä½?
- [ADR-0002](./0002-defer-protocol-selection.md) - UIX IR ?è®®ç­–ç•¥
- [ADR-0006](./0006-lucid-ir-specification.md) - UIX IR è§„è?å®šä?

